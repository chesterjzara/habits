<!DOCTYPE html>
<html lang="en">
<head>
    <% include ../partials/head.ejs %>
    <script src="/js/habit-index1.js" charset="utf-8"></script>
    <title>Habit Tracking | Habits</title>
</head>
<body>
    <% include ../partials/nav.ejs %>

    <h1>All Habits</h1>

    
    <% for(let t = 0; t < tags.length; t++) { %>
        <div class="tag-habit-container">
            <div class="row tag-title">
                <h1 class="col"><%= tags[t] %></h1>
                <a class="col" href="/habits/new?category=<%= tags[t] %>">New Habit</a>
            </div>
                <div class="habit-data-container">
                    <div class="row date-row">
                        <div class="col"> </div>
                        <!-- Add the dates for each tag -->
                        <% for(let j = 5; j >= 0; j--) { %>
                            <div class="col text-center date-header" date-number="<%=j%>"> </div>
                        <% } %>
                        <div class="col">  </div>
                    </div>
                    <% for(let i = 0; i < habits.length; i++) { %>
                        <% if (habits[i].tag === tags[t]) { %>
                            <div class="row">
                                <div class=col><a href="/habits/<%= habits[i]._id %>"><%= habits[i].name %></a></div>
                                <% for(let j = 5; j >= 0; j--) { %>
                                    <% let pageDay = moment().startOf('day').subtract(j, 'days').format();
                                    let checked = false; %>
                                    <% for(let checkDates of habits[i].date_data) { 
                                        if(moment(checkDates).isSame(pageDay, 'day')) { 
                                            checked = true;
                                        }
                                    } %>   
                                    
                                    <div class="habit-checkbox col text-center" habit-date="<%= moment().startOf('day').subtract(j, 'days').format() %>" habit-id="<%= habits[i]._id %>" habit-checked=<% if(checked) { %> 
                                            "true"  
                                        <% } else { %>
                                            "false"
                                        <% } %>
                                    > 
                                       O
                                    </div>
                                    
                                <% } %>
                                <div class="col"> Notes </div>
                            </div>
                        <% } %>
                    <% } %>
                </div>
        </div>
    <% } %>
</body>
</html>